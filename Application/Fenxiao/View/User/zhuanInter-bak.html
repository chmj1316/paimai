
    <body>
        <div class="TopTitle">
            <a class="return" href="{:U('User/index')}"></a>
            <label class="Detailed" style="margin-right:60px;">积分转赠</label>
        </div>
        <div class="topTab">
            <div class="Tab active" data-href="{:U('User/zhuanInter')}">积分转赠</div>
            <div class="Tab" data-href="{:U('User/zhuanMoney')}">余额转赠</div>
        </div>
        <div class="AddressAddInfo active">
            <div class="RowDiv">
                <div class="left">累计数量：</div>
                <div class="right"><span>{$user_info['fx_inter_lj']}</span></div>
            </div>
            <div class="RowDiv">
                <div class="left">现有数量：</div>
                <div class="right"><span id="nowmoney">{$user_info['fx_inter']}</span></div>
            </div>
            <div class="RowDiv">
                <div class="left">可用数量：</div>
                <div class="right"><span data-moneys="{$user_info['fx_inter']}" id="myliveMoney">{$user_info['fx_inter']}</span></div>
            </div>

            <div class="RowDiv">
                <div class="left">获赠人ID：</div>
                <div class="right">
                    <input type="number" id="userId" placeholder="点击确认后会提示昵称">
                </div>
            </div>
            <div class="RowDiv">
                <div class="left">转赠数量：</div>
                <div class="right">
                    <input type="number" id="moneysAmount" placeholder="最多转赠数量：{$user_info['fx_inter']}">
                </div>
            </div>
        </div>
        <button class="AddAddress" id="btnBegin">确认转赠</button>
        <script type="text/javascript">
            $('[data-href]').click(function() {
                var href = $(this).data('href');
                window.location.href = href;
            });

            $('#btnBegin').bind('click', function () {
                $("#btnBegin").attr('disabled', true)
                var type = $('#type').val();
                var liveMoney = $('#myliveMoney').data('moneys');
                var userId = $('#userId').val();
                var moneysAmount = $('#moneysAmount').val();
                if (moneysAmount % 100 != 0  || moneysAmount == 0) {
                    alert('转赠失败,转赠数量必需能整除100');
                    return false;
                }
                if (isNaN(userId) || isNaN(moneysAmount) || userId < 1 || moneysAmount <= 0) {
                    alert('获赠人ID或转赠数量填写错误!');
                    return;
                }
                if (userId == '{$user_info['user_id']}') {
                    alert('囧，自己不能赠送给自己。');
                    return;
                }
                if (parseFloat(liveMoney) < parseFloat(moneysAmount)) {
                    alert('转赠数量不能大于您的可用数量。');
                    $('#moneysAmount').focus();
                    return;
                }
                $.ajax({
                    url: "{:U('checkUser')}",
                    data: {uid: userId},
                    type: 'post',
                    dataType: 'json',
                    beforeSend: function() {
                        $("#btnBegin").attr('disabled', true);
                    },
                    success: function(msg) {
                        if (msg.status) {
                            if (confirm('确认转赠给' + msg.info)) {
                                $.ajax({
                                    data: {uid: userId, inter: moneysAmount},
                                    type: 'post',
                                    dataType: 'json',
                                    success: function(rep) {
                                        if (rep.status) {
                                            alert(rep.info)
                                            window.location.reload()
                                        } else {
                                            $("#btnBegin").attr('disabled', false)
                                            alert(rep.info)
                                        }
                                    },
                                    error: function() {
                                        $("#btnBegin").attr('disabled', false)
                                        alert('网络异常...')
                                    }
                                })
                            } else {
                                $("#btnBegin").attr('disabled', false)
                            }
                        } else {
                            $("#btnBegin").attr('disabled', false)
                            alert(msg.info)
                        }
                    },
                    error: function() {
                        $("#btnBegin").attr('disabled', false)
                        alert('网络异常...')
                    }
                })
            });
        </script>


    </body>

</html>
